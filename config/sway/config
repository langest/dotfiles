### --- Startup media --- ###
# TODO
# exec_always mpv --no-terminal --volume=100 ~/Music/Windows_95_Startup_Sound.m4a

### --- Variables --- ###
set $mod Mod1
set $term foot
set $script_home ~/repos/dotfiles/scripts
set $notify_duration 325
set $launcher "wofi --show drun"
set $screenshot_dir ~/Pictures/screenshots
# set $launcher wofi --show run  # another alternative

font pango:monospace 8

### --- Autostart --- ###
exec_always mkdir -p $screenshot_dir
exec dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP=sway
exec_always systemctl --user import-environment WAYLAND_DISPLAY XDG_CURRENT_DESKTOP SWAYSOCK
exec dex --autostart --environment sway
exec mako

# Keyboard config (caps as ctrl)
input * {
    xkb_layout us,se
    xkb_options ctrl:nocaps
}

# Network + Apps
exec nm-applet --indicator

### --- Volume and Audio --- ###
set $vol_step 5%
bindsym XF86AudioRaiseVolume exec bash $script_home/t16/volume_step.sh up 5 && notify-send -t $notify_duration 'Volume Up'
bindsym XF86AudioLowerVolume exec bash $script_home/t16/volume_step.sh down 5 && notify-send -t $notify_duration 'Volume Down'
bindsym XF86AudioMute exec wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle && notify-send -t $notify_duration 'Mute toggled'
bindsym XF86AudioMicMute exec wpctl set-mute @DEFAULT_AUDIO_SOURCE@ toggle && notify-send -t $notify_duration 'Mic mute toggled'

# --- Screen brightness ---
set $brightness_step 10%
bindsym XF86MonBrightnessUp exec brightnessctl set +$brightness_step && notify-send -t $notify_duration 'Brightness +'
bindsym XF86MonBrightnessDown exec brightnessctl set $brightness_step- && notify-send -t $notify_duration 'Brightness -'

### --- Window behavior --- ###
floating_modifier $mod
bindsym $mod+Shift+Return exec $term
bindsym $mod+Shift+c kill
bindsym $mod+p exec $launcher

# Focus movement
bindsym $mod+h focus left
bindsym $mod+j focus down
bindsym $mod+k focus up
bindsym $mod+l focus right

# Move window
bindsym $mod+Shift+h move left
bindsym $mod+Shift+j move down
bindsym $mod+Shift+k move up
bindsym $mod+Shift+l move right

# Resize window
bindsym $mod+Ctrl+Shift+h resize shrink width 128px
bindsym $mod+Ctrl+Shift+j resize shrink height 128px
bindsym $mod+Ctrl+Shift+k resize grow height 128px
bindsym $mod+Ctrl+Shift+l resize grow width 128px

# Split modes
bindsym $mod+v split v
bindsym $mod+b split h
bindsym $mod+w layout tabbed
bindsym $mod+e layout toggle split

# Fullscreen toggle
bindsym $mod+f fullscreen toggle

# Floating toggle
bindsym $mod+Shift+space floating toggle
bindsym $mod+space focus mode_toggle

# Parent focus
bindsym $mod+a focus parent


### --- Workspaces and monitor --- ###
bindsym XF86Display exec bash $script_home/t16/monitor_toggle.sh
output DP-2 transform 270

set $ws0 "0"
set $ws1 "1"
set $ws2 "2"
set $ws3 "3"
set $ws4 "4"
set $ws5 "5"
set $ws6 "6"
set $ws7 "7"
set $ws8 "8"
set $ws9 "9"
set $ws10 "10"
set $ws11 "11"
set $ws12 "12"

# Internal eDP-1
# Middle HDMI-A-1
# Left DP-2
workspace $ws1 output DP-2
workspace $ws2 output DP-2
workspace $ws3 output DP-2
workspace $ws4 output DP-2
workspace $ws5 output DP-2
workspace $ws6 output DP-2
workspace $ws7 output HDMI-A-1
workspace $ws8 output HDMI-A-1
workspace $ws9 output HDMI-A-1
workspace $ws10 output HDMI-A-1
workspace $ws11 output HDMI-A-1
workspace $ws12 output HDMI-A-1
workspace $ws0 output eDP-1

# Workspace switching
bindsym $mod+1 workspace $ws1
bindsym $mod+2 workspace $ws2
bindsym $mod+3 workspace $ws3
bindsym $mod+4 workspace $ws4
bindsym $mod+5 workspace $ws5
bindsym $mod+6 workspace $ws6
bindsym $mod+7 workspace $ws7
bindsym $mod+8 workspace $ws8
bindsym $mod+9 workspace $ws9
bindsym $mod+0 workspace $ws10
bindsym $mod+minus workspace $ws11
bindsym $mod+equal workspace $ws12

# Move container to workspace
bindsym $mod+Shift+1 move container to workspace $ws1
bindsym $mod+Shift+2 move container to workspace $ws2
bindsym $mod+Shift+3 move container to workspace $ws3
bindsym $mod+Shift+4 move container to workspace $ws4
bindsym $mod+Shift+5 move container to workspace $ws5
bindsym $mod+Shift+6 move container to workspace $ws6
bindsym $mod+Shift+7 move container to workspace $ws7
bindsym $mod+Shift+8 move container to workspace $ws8
bindsym $mod+Shift+9 move container to workspace $ws9
bindsym $mod+Shift+0 move container to workspace $ws10
bindsym $mod+Shift+minus move container to workspace $ws11
bindsym $mod+Shift+equal move container to workspace $ws12

# Restart sway
bindsym $mod+Shift+r reload

# Exit sway
bindsym $mod+Shift+Ctrl+q exec "swaynag -t warning -m 'Exit Sway?' -B 'Yes' 'swaymsg exit'"

### --- Appearance --- ###
for_window [class="^.*"] border pixel 1

exec waybar

input "2:10:TPPS/2_Elan_TrackPoint" {
    accel_profile flat
    pointer_accel 0.2
}

input "1922:27:-_GameBall" {
    accel_profile flat
    pointer_accel -0.7
}

bindsym $mod+Tab workspace back_and_forth

smart_gaps on
gaps inner 4

### --- Scripts / shortcuts --- ###
bindsym $mod+Shift+w exec bash $script_home/t16/wallpaper.sh
bindsym $mod+Shift+e exec bash $script_home/t16/wallpaper_tiling.sh
bindsym $mod+Shift+f exec firefox
bindsym $mod+Shift+g exec chromium

# Scratchpad
bindsym $mod+Shift+s move scratchpad
bindsym $mod+s scratchpad show

# Cycle keyboard layout
bindsym Ctrl+space exec bash -c 'swaymsg input "*" xkb_switch_layout next; L=$(swaymsg -t get_inputs | grep -m1 -Po "\"xkb_active_layout_name\": *\"\K[^\"]+" || swaymsg -t get_inputs | grep -m1 -Po "\"xkb_layout\": *\"\K[^\"]+"); notify-send -t $notify_duration "Layout: $L"'

# Screenshot (grim + slurp)
bindsym $mod+Shift+p exec grim -g "$(slurp)" $screenshot_dir/$(date +'%Y-%m-%d-%H%M%S').png

# Suspend
bindsym $mod+Shift+q exec systemctl suspend
# --- Idle (fixed) ---
exec_always swayidle \
    timeout 540 'swaymsg "output * dpms off"' \
    resume 'swaymsg "output * dpms on"' \
    timeout 600 'systemctl suspend' \
    before-sleep 'swaylock -f -c 0F0F0F'

### --- App assignments --- ###
assign [app_id="thunderbird"] $ws2
assign [app_id="keepassxc"] $ws3
assign [app_id="signal"] $ws4
assign [app_id="discord"] $ws5
assign [app_id="qbittorrent"] $ws6
assign [app_id="chromium"] $ws8
assign [app_id="firefox"] $ws9

#bindsym $mod+b bar mode toggle
